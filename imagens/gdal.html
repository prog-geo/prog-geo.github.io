<!DOCTYPE html>
<html class="writer-html5" lang="pt-BR" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.1. GDAL - Geospatial Data Abstraction Library &mdash; SER-347/CAP-419</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/table_styling.css" type="text/css" />
      <link rel="stylesheet" href="../_static/prog-geo.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="https://prog-geo.github.io/imagens/gdal.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/translations.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Buscar" href="../search.html" />
    <link rel="next" title="4.2. NumPy" href="numpy.html" />
    <link rel="prev" title="4. Imagens - Processamento e Visualização" href="../imagens.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >
            <a href="../index.html" class="icon icon-home"> SER-347/CAP-419
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Pesquisar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Menu de navegação">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introdução à Programação com Dados Geoespaciais</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Visão Geral do Curso:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../visao-geral.html">Visão Geral do Curso</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Aulas:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../instalacao.html">1. Instalando e Configurando o Ambiente de Programação</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introducao-programacao.html">2. Introdução à Programação com a Linguagem Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter.html">3. Jupyter</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../imagens.html">4. Imagens - Processamento e Visualização</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.1. GDAL - <strong>G</strong>eospatial <strong>D</strong>ata <strong>A</strong>bstraction <strong>L</strong>ibrary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#importando-a-biblioteca-gdal">4.1.1. Importando a Biblioteca GDAL</a></li>
<li class="toctree-l3"><a class="reference internal" href="#abertura-de-um-arquivo-raster">4.1.2. Abertura de um arquivo <em>raster</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#estrutura-do-dataset">4.1.3. Estrutura do <em>Dataset</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#transformacao-afim">4.1.4. Transformação Afim</a></li>
<li class="toctree-l3"><a class="reference internal" href="#leitura-dos-dados-de-uma-banda">4.1.5. Leitura dos dados de uma banda</a></li>
<li class="toctree-l3"><a class="reference internal" href="#liberando-um-conjunto-de-dados">4.1.6. Liberando um conjunto de dados</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="numpy.html">4.2. NumPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualizacao.html">4.3. Visualização de Imagens</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../vetorial.html">5. Manipulação de Dados Vetoriais</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qgis.html">6. Programando com o QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../variados.html">7. Tópicos Variados</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Referências Bibliográficas</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../referencias.html">Referências Bibliográficas</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Listas de Exercícios:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../listas.html">Listas de Exercícios</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lista de Projetos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../projetos.html">Projetos Finais</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Informações Gerais:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../licenca.html">Licença</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Agradecimentos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../agradecimentos.html">Agradecimentos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Menu de navegação móvel"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SER-347/CAP-419</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Navegação da página">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../imagens.html"><span class="section-number">4. </span>Imagens - Processamento e Visualização</a> &raquo;</li>
      <li><span class="section-number">4.1. </span>GDAL - <strong>G</strong>eospatial <strong>D</strong>ata <strong>A</strong>bstraction <strong>L</strong>ibrary</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Navegação sequencial da página">
        <a href="../imagens.html" class="btn btn-neutral float-left" title="4. Imagens - Processamento e Visualização" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="numpy.html" class="btn btn-neutral float-right" title="4.2. NumPy" accesskey="n">Próximo <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="gdal-geospatial-data-abstraction-library">
<span id="sec-imagens-gdal"></span><h1><span class="section-number">4.1. </span>GDAL - <strong>G</strong>eospatial <strong>D</strong>ata <strong>A</strong>bstraction <strong>L</strong>ibrary<a class="headerlink" href="#gdal-geospatial-data-abstraction-library" title="Link permanente para este título"></a></h1>
<a class="reference internal image-reference" href="../_images/gdal.svg"><img alt="GDAL" class="align-right" src="../_images/gdal.svg" width="96" /></a>
<p>A <a class="reference external" href="https://gdal.org">GDAL</a> é uma biblioteca de software livre que fornece uma camada de abstração de dados geoespaciais, possibilitando o desenvolvimento de aplicações que manipulam dados nos mais diferentes formatos e sistemas. A <code class="docutils literal notranslate"><span class="pre">API</span></code> (<em>Application Programming Interface</em> ou Interface de Programação de Aplicações) desta biblioteca encontra-se disponível para uso em Python através de um <em>binding</em> (ou <em>wrapper</em>), que fornece acesso às funcionalidades implementadas em C++.</p>
<p>A GDAL é basicamente composta de quatro APIs:</p>
<ul class="open">
<li><p><strong>GDAL</strong>: Voltada para manipulação de dados matriciais (<em>raster</em>), com capacidade de leitura e escrita de <a class="reference external" href="http://gdal.org/formats_list.html">diversos formatos</a> de imagem de sensoriamento remoto, como GeoTIFF, HDF, e JPEG, entre outros. Esta parte da API contém objetos para manipulação das dimensões de uma imagem, para acesso de leitura e escrita de blocos das bandas espectrais de uma imagem, acesso a metadados e manipulação de pirâmides de multi-resolução.</p></li>
<li><p><strong>OGR</strong>: Parte da API voltada para manipulação de dados em <a class="reference external" href="https://gdal.org/drivers/vector/index.html">formatos vetoriais</a>, tais como ESRI Shapefile, Google KML e GeoJSON. Apresenta os conceitos de camada de informação, feições, atributos alfanuméricos e geométricos.</p></li>
<li><p><strong>OSR</strong>: Voltada para a manipulação de projeções e sistemas de referência espacial.</p></li>
<li><p><strong>GNM</strong>: Acrônimo de <em>Geographic Network Model</em>, esta parte da API serve ao propósito de manipulação de redes geográficas.</p></li>
</ul>
<p>As aplicações que utilizam a GDAL acessam todos os formatos suportados por ela através de um único modelo de dados abstrato. Além disso, a GDAL também conta com uma variedade de programas utilitários de linha de comando para a tradução de formatos e alguns tipos básicos de processamento.</p>
<p>Utilizaremos a GDAL para manipular imagens de sensoriamento remoto, através do acesso aos valores dos pixels das bandas, por meio de matrizes no formato da biblioteca <a class="reference external" href="https://numpy.org/">NumPy</a>.</p>
<div class="section" id="importando-a-biblioteca-gdal">
<h2><span class="section-number">4.1.1. </span>Importando a Biblioteca GDAL<a class="headerlink" href="#importando-a-biblioteca-gdal" title="Link permanente para este título"></a></h2>
<p>Para acessar a API <code class="docutils literal notranslate"><span class="pre">gdal</span></code>, que permitirá manipular as imagens, devemos importar a biblioteca <code class="docutils literal notranslate"><span class="pre">osgeo</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
</pre></div>
</div>
<p>Uma boa prática consiste em ativar o uso de exceções nas operações da biblioteca GDAL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdal</span><span class="o">.</span><span class="n">UseExceptions</span><span class="p">()</span>
</pre></div>
</div>
<p>Para saber a versão da GDAL instalada no seu ambiente de trabalho, use o seguinte comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdal</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Em um ambiente Jupyter Notebook, você pode conferir também as versões das demais ferramentas do seu ambiente:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>print(&#39;* Python&#39;)
!python --version

print(&#39;* Jupyter&#39;)
!jupyter --version

print(&#39;* Jupyter Notebook&#39;)
!jupyter notebook --version
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Dentro de um Jupyter Notebook podemos utilizar o recurso de auto-completar. Após o operador de membro <code class="docutils literal notranslate"><span class="pre">.</span></code>, o ambiente Jupyter irá fornecer uma lista das operações disponíveis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdal</span><span class="o">.</span>
</pre></div>
</div>
<p>Também podemos obter ajuda sobre as funções e objetos disponíveis em uma biblioteca utilizando o caractere <code class="docutils literal notranslate"><span class="pre">?</span></code> ou <code class="docutils literal notranslate"><span class="pre">??</span></code> logo após o nome para o qual desejamos consultar a ajuda, como mostrado abaixo para a função Open:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gdal.Open?
</pre></div>
</div>
</div>
</div>
<div class="section" id="abertura-de-um-arquivo-raster">
<h2><span class="section-number">4.1.2. </span>Abertura de um arquivo <em>raster</em><a class="headerlink" href="#abertura-de-um-arquivo-raster" title="Link permanente para este título"></a></h2>
<p>A função <code class="docutils literal notranslate"><span class="pre">Open</span></code> é utilizada para abrir um conjunto de dados (ou <code class="docutils literal notranslate"><span class="pre">dataset</span></code>), que exige dois parâmetros:</p>
<ul class="open">
<li><p><strong>Nome do Arquivo</strong>: caminho e nome completo</p></li>
<li><p><strong>Forma de Acesso</strong>: constante que indica se o arquivo será usado apenas para leitura (<code class="docutils literal notranslate"><span class="pre">GA_ReadOnly</span></code>) ou se também será utilizado em operações de escrita (<code class="docutils literal notranslate"><span class="pre">GA_Update</span></code>).</p></li>
</ul>
<p>Para abrir o arquivo GeoTIFF com a imagem (<a class="reference external" href="https://drive.google.com/u/0/uc?id=1WbQ3aYWjYPpHxA3Z03_qVVTAncgr7PV_&amp;export=download">faça o download da imagem de teste</a>), podemos fazer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;crop_rapideye.tif&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span>
</pre></div>
</div>
<p>Neste caso, o nome do arquivo é <code class="docutils literal notranslate"><span class="pre">crop_rapideye.tif</span></code> e, a forma de acesso é <code class="docutils literal notranslate"><span class="pre">GA_ReadOnly</span></code>.</p>
<p>Repare o tipo de objeto retornado pela operação <code class="docutils literal notranslate"><span class="pre">gdal.Open</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
<p>Saída:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">osgeo</span><span class="o">.</span><span class="n">gdal</span><span class="o">.</span><span class="n">Dataset</span>
</pre></div>
</div>
</div>
<div class="section" id="estrutura-do-dataset">
<h2><span class="section-number">4.1.3. </span>Estrutura do <em>Dataset</em><a class="headerlink" href="#estrutura-do-dataset" title="Link permanente para este título"></a></h2>
<div class="section" id="sistema-de-referencia-espacial">
<h3><span class="section-number">4.1.3.1. </span>Sistema de Referência Espacial<a class="headerlink" href="#sistema-de-referencia-espacial" title="Link permanente para este título"></a></h3>
<p>Para conhecer o sistema de coordenadas de referência (CRS) de um <code class="docutils literal notranslate"><span class="pre">dataset</span></code>, deve ser utilizado o método <code class="docutils literal notranslate"><span class="pre">GetProjectionRef</span></code>, que retorna uma descrição no formato WKT (<em>Well-Known Text</em>). O WKT é um formato textual, padronizado pela OGC (<em>Open Geospatial Consortium</em>), para representação de sistemas de referência espacial dos objetos geográficos.</p>
<p>Para recuperar a informação sobre a Referência Espacial de uma imagem, usa-se o método <code class="docutils literal notranslate"><span class="pre">GetProjectionRef</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">GetProjectionRef</span><span class="p">()</span>
</pre></div>
</div>
<p>Um Sistema de Referência Espacial (<em>Spatial Reference System</em> - <strong>SRS</strong>) ou sistema de coordenadas de referência (<em>Coordinate Reference System</em> - <strong>CRS</strong>) pode ser um sistema local, regional ou global, usado para localizar objetos geográficos.</p>
<p>Para permitir uma maior interoperabilidade e facilidade na utilização, vários sistemas de informação geográfica fazem referência a um SRS indicando apenas um número inteiro que representa o <code class="docutils literal notranslate"><span class="pre">SRID</span></code>, ou códigos, como o <code class="docutils literal notranslate"><span class="pre">EPSG</span></code>, definidos por autoridades como a <a class="reference external" href="https://www.iogp.org/">Associação Internacional de Produtores de Petróleo e Gás</a>.</p>
<p>Para identificar os códigos corretos para o sistema de referência espacial do seu interesse, veja os seguintes portais:</p>
<ul class="open">
<li><p><a class="reference external" href="http://epsg.io">http://epsg.io</a></p></li>
<li><p><a class="reference external" href="http://spatialreference.org">http://spatialreference.org</a></p></li>
</ul>
</div>
</div>
<div class="section" id="transformacao-afim">
<h2><span class="section-number">4.1.4. </span>Transformação Afim<a class="headerlink" href="#transformacao-afim" title="Link permanente para este título"></a></h2>
<p>O método <code class="docutils literal notranslate"><span class="pre">GetGeoTransform</span></code> retorna uma tupla com os 06 coeficientes referentes à transformação afim do <code class="docutils literal notranslate"><span class="pre">dataset</span></code>, isto é, os parâmetros para transformação do espaço de coordenadas da imagem (linha e coluna) para coordendas georreferenciadas (coordenadas projetadas ou geográficas).</p>
<p>Vamos obter o valor desses coeficientes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">&gt;&gt;&gt;</span> <span class="n">GT</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">GT</span><span class="p">)</span>
<span class="p">(</span><span class="mf">508810.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">7857490.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">)</span>
</pre></div>
</div>
<p>Na tupla acima, temos o seguinte:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Índice</p></th>
<th class="head"><p>Coeficiente</p></th>
<th class="head"><p>Descrição</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>508810.0</p></td>
<td><p>Coordenada-<span class="math notranslate nohighlight">\(x\)</span> do pixel do canto superior esquerdo da imagem.</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>5.0</p></td>
<td><p>Resolução do pixel ao longo do eixo-<span class="math notranslate nohighlight">\(x\)</span>.</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>0.0</p></td>
<td><p>Rotação ao longo das linhas. Zero para imagens alinhadas ao norte (north-up image).</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>7857490.0</p></td>
<td><p>Coordenada-<span class="math notranslate nohighlight">\(y\)</span> do pixel do canto superior esquerdo da imagem.</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>0.0</p></td>
<td><p>Rotação ao longo das colunas. Zero para imagens alinhadas ao norte (north-up image)</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>-5.0</p></td>
<td><p>Resolução do pixel ao longo do eixo-<span class="math notranslate nohighlight">\(y\)</span>.</p></td>
</tr>
</tbody>
</table>
<p>Os parâmetros acima podem ser usados na seguinte equação de transformação:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
X_{geo} = GT[0] + Coluna * GT[1] + Linha * GT[2]\\
Y_{geo} = GT[3] + Coluna * GT[4] + Linha * GT[5]
\end{cases}\end{split}\]</div>
<p>No caso de imagens alinhadas ao norte (north up images), essa equação se resume a:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
X_{geo} = GT[0] + Coluna * GT[1]\\
Y_{geo} = GT[3] + Linha * GT[5]
\end{cases}\end{split}\]</div>
<p>Vamos calcular a localização no espaço geográfico do pixel que está na <code class="docutils literal notranslate"><span class="pre">coluna</span></code> 20 e <code class="docutils literal notranslate"><span class="pre">linha</span></code> 30:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coluna</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">linha</span> <span class="o">=</span> <span class="mi">30</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">GT</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">coluna</span> <span class="o">*</span> <span class="n">GT</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">GT</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">linha</span> <span class="o">*</span> <span class="n">GT</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Para mais informaçõs sobre essa operação, consulte <a class="reference external" href="https://gdal.org/tutorials/geotransforms_tut.html">Geotransform Tutorial</a>.</p>
</div>
<div class="section" id="dimensoes-numero-de-linhas-e-colunas">
<h3><span class="section-number">4.1.4.1. </span>Dimensões (Número de linhas e colunas)<a class="headerlink" href="#dimensoes-numero-de-linhas-e-colunas" title="Link permanente para este título"></a></h3>
<p>Para saber o número de linhas e colunas do <code class="docutils literal notranslate"><span class="pre">dataset</span></code> que está sendo utilizado, devemos utilizar as propriedades <code class="docutils literal notranslate"><span class="pre">RasterYSize</span></code> e <code class="docutils literal notranslate"><span class="pre">RasterXSize</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">linhas</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">RasterYSize</span>
<span class="n">colunas</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">RasterXSize</span>

<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Número de linhas:&quot;</span><span class="p">,</span> <span class="n">linhas</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Número de colunas:&quot;</span><span class="p">,</span> <span class="n">colunas</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="bandas">
<h3><span class="section-number">4.1.4.2. </span>Bandas<a class="headerlink" href="#bandas" title="Link permanente para este título"></a></h3>
<p>Para saber o número de bandas de um <code class="docutils literal notranslate"><span class="pre">dataset</span></code>, podemos utilizar a propriedade <code class="docutils literal notranslate"><span class="pre">RasterCount</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span><span class="o">.</span><span class="n">RasterCount</span>
<span class="go">5</span>
</pre></div>
</div>
<p>Como pode ser observado, o arquivo <code class="docutils literal notranslate"><span class="pre">crop_rapideye.tif</span></code> possui 5 bandas.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>A GDAL numera as bandas de 1 até <span class="math notranslate nohighlight">\(n\)</span>, onde <span class="math notranslate nohighlight">\(n\)</span> é o número total de bandas contidas no <code class="docutils literal notranslate"><span class="pre">dataset</span></code>. Lembre-se que os objetos do Python, como listas e tuplas, são indexados a partir do número <span class="math notranslate nohighlight">\(0\)</span> até <span class="math notranslate nohighlight">\(n - 1\)</span>.</p>
</div>
<p>No caso da amostra de imagem RapidEye, as bandas 5 e 3 correspondem às bandas NIR e RED, respectivamente. Para acessar os dados dessas bandas, devemos utilizar o método <code class="docutils literal notranslate"><span class="pre">GetRasterBand</span></code>, que retorna um objeto capaz de manipular os dados de uma banda:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">banda_nir</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">banda_red</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Um objeto do tipo banda contém as informações dos níveis digitais das imagens, além de outras propriedades, como:</p>
<ul class="open">
<li><p><code class="docutils literal notranslate"><span class="pre">NoDataValue</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Minimum</span></code>/<code class="docutils literal notranslate"><span class="pre">Maximum</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Histogram</span></code></p></li>
<li><p>Tipo de dados</p></li>
<li><p>Estatísticas (média/desvio padrão)</p></li>
<li><p>Matriz de pixels</p></li>
</ul>
<p>Uma das propriedades para a correta manipulação das imagens é o tipo de dados, <code class="docutils literal notranslate"><span class="pre">DataType</span></code>, armazenado e que pode ser lido a partir da operação <code class="docutils literal notranslate"><span class="pre">GetDataTypeName</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Tipos de dados:&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot; - banda NIR:&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDataTypeName</span><span class="p">(</span><span class="n">banda_nir</span><span class="o">.</span><span class="n">DataType</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot; - banda RED:&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDataTypeName</span><span class="p">(</span><span class="n">banda_red</span><span class="o">.</span><span class="n">DataType</span><span class="p">))</span>
</pre></div>
</div>
<p>É possível saber quais os valores extremos (mínimo e máximo) dos pixels de uma banda utilizando o método <code class="docutils literal notranslate"><span class="pre">ComputeRasterMinMax</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">menor_valor</span><span class="p">,</span> <span class="n">maior_valor</span> <span class="o">=</span> <span class="n">banda_red</span><span class="o">.</span><span class="n">ComputeRasterMinMax</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Menor valor de RED:&quot;</span><span class="p">,</span> <span class="n">menor_valor</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maior valor de RED:&quot;</span><span class="p">,</span> <span class="n">maior_valor</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="leitura-dos-dados-de-uma-banda">
<h2><span class="section-number">4.1.5. </span>Leitura dos dados de uma banda<a class="headerlink" href="#leitura-dos-dados-de-uma-banda" title="Link permanente para este título"></a></h2>
<p>Depois de criados os objetos das bandas (banda_nir e banda_red), podemos ler os dados de cada banda para iniciar qualquer processamento com estes valores. Para isso, utilizaremos o método <code class="docutils literal notranslate"><span class="pre">ReadAsArray</span></code>, que permitirá obter os dados de cada banda em uma matriz NumPy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matriz_red</span> <span class="o">=</span> <span class="n">banda_red</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
<span class="n">matriz_nir</span> <span class="o">=</span> <span class="n">banda_nir</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
</pre></div>
</div>
<p>Essa operação retornará uma matriz do NumPy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">matriz_red</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">matriz_red</span>
</pre></div>
</div>
<p>Agora, podemos utilizar todas as operações disponíveis na <a class="reference external" href="https://numpy.org/">NumPy</a>:</p>
<ul>
<li><p>Para verificar se a matriz gerada com a leitura da banda foi criada com o número de linhas e colunas de forma correta, podemos utilizar o atributo <code class="docutils literal notranslate"><span class="pre">shape</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matriz_red</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</li>
<li><p>Para saber o tipo de dados das células da matriz, podemos usar a propriedade <code class="docutils literal notranslate"><span class="pre">dtype</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matriz_red</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>
</div>
</li>
</ul>
<p>Para computar um índice de vegetação, o NDVI, a partir das matrizes com os valores das bandas RED e NIR, aplicamos uma operação matricial, envolvendo as 2 matrizes obtidas a partir das bandas da imagem:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matriz_red</span> <span class="o">=</span> <span class="n">matriz_red</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">matriz_nir</span> <span class="o">=</span> <span class="n">matriz_nir</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># geracao de array derivado das bandas</span>
<span class="n">matriz_ndvi</span> <span class="o">=</span> <span class="p">(</span><span class="n">matriz_nir</span> <span class="o">-</span> <span class="n">matriz_red</span><span class="p">)</span> <span class="o">/</span> \
              <span class="p">(</span><span class="n">matriz_nir</span> <span class="o">+</span> <span class="n">matriz_red</span> <span class="o">+</span> <span class="mf">0.000000001</span><span class="p">)</span>

<span class="c1"># mostrar as dimensoes e tipo de dado da matriz de saida</span>
<span class="nb">print</span><span class="p">(</span><span class="n">matriz_ndvi</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">matriz_ndvi</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">matriz_ndvi</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>No cálculo da <code class="docutils literal notranslate"><span class="pre">matriz_ndvi</span></code> foi colocado um termo adicional no denominador, 0.000000001. Embora não faça parte da equação original, este termo evita que aconteçam divisões por zero, gerando valores nulos, ou inconsistentes, na matriz final. Por ser um valor muito pequeno, não impacta no resultado dos demais cálculos.</p>
</div>
<p>Podemos combinar as bibliotecas NumPy e Matplotlib para visualizar as matrizes como imagens:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Banda RED&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">matriz_red</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Banda NIR&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">matriz_nir</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;NDVI&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">matriz_ndvi</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="liberando-um-conjunto-de-dados">
<h2><span class="section-number">4.1.6. </span>Liberando um conjunto de dados<a class="headerlink" href="#liberando-um-conjunto-de-dados" title="Link permanente para este título"></a></h2>
<p>Para liberar a memória e fechar o arquivo aberto, associamos o valor <code class="docutils literal notranslate"><span class="pre">None</span></code> ao identificador do <code class="docutils literal notranslate"><span class="pre">dataset</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Realizar esta operação não significa que matrizes NumPy obtidas das bandas da mesma imagem serão liberadas. Após a operação <code class="docutils literal notranslate"><span class="pre">ReadAsArray</span></code>, o <code class="docutils literal notranslate"><span class="pre">dataset</span></code> e a matriz são objetos independentes.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Rodapé">
        <a href="../imagens.html" class="btn btn-neutral float-left" title="4. Imagens - Processamento e Visualização" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="numpy.html" class="btn btn-neutral float-right" title="4.2. NumPy" accesskey="n" rel="next">Próximo <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2021, Gilberto Queiroz and Thales Körting.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-165908761-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-165908761-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>
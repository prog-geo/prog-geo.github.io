<!DOCTYPE html>
<html class="writer-html5" lang="pt-BR" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5.6. Leitura/Escrita de Dados Vetoriais &mdash; SER-347/CAP-419</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/table_styling.css" type="text/css" />
      <link rel="stylesheet" href="../_static/prog-geo.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="https://prog-geo.github.io/vetorial/geo-io.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Buscar" href="../search.html" />
    <link rel="next" title="5.7. Pandas" href="pandas.html" />
    <link rel="prev" title="5.5. Documentos GeoJSON" href="geojson.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            SER-347/CAP-419
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Pesquisar documentos" aria-label="Pesquisar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Menu de navegação">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introdução à Programação com Dados Geoespaciais</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Visão Geral do Curso:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../visao-geral.html">Visão Geral do Curso</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Aulas:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../instalacao.html">1. Instalando e Configurando o Ambiente de Programação</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introducao-programacao/index.html">2. Introdução à Programação com a Linguagem Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter.html">3. Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imagens.html">4. Imagens - Processamento e Visualização</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../vetorial.html">5. Manipulação de Dados Vetoriais</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introducao.html">5.1. Introdução</a></li>
<li class="toctree-l2"><a class="reference internal" href="tipos-geometricos.html">5.2. Tipos Geométricos</a></li>
<li class="toctree-l2"><a class="reference internal" href="shapely.html">5.3. Tipos Geométricos em Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="json.html">5.4. Documentos JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="geojson.html">5.5. Documentos GeoJSON</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.6. Leitura/Escrita de Dados Vetoriais</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-biblioteca-fiona">5.6.1. A Biblioteca Fiona</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-biblioteca-gdal-ogr">5.6.2. A biblioteca GDAL/OGR</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pandas.html">5.7. Pandas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../variados.html">6. Tópicos Variados</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Referências Bibliográficas</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../referencias.html">Referências Bibliográficas</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Listas de Exercícios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../listas/index.html">Listas de Exercícios</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lista de Projetos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../projetos/2023/index.html">Turma 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projetos/2022/index.html">Turma 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projetos/2021/index.html">Turma 2021</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Informações Gerais:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../licenca.html">Licença</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Agradecimentos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../agradecimentos.html">Agradecimentos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Menu de navegação móvel"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SER-347/CAP-419</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Navegação da página">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../vetorial.html"><span class="section-number">5. </span>Manipulação de Dados Vetoriais</a></li>
      <li class="breadcrumb-item active"><span class="section-number">5.6. </span>Leitura/Escrita de Dados Vetoriais</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Navegação sequencial da página">
        <a href="geojson.html" class="btn btn-neutral float-left" title="5.5. Documentos GeoJSON" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="pandas.html" class="btn btn-neutral float-right" title="5.7. Pandas" accesskey="n">Próximo <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="leitura-escrita-de-dados-vetoriais">
<span id="sec-vetorial-geo-io"></span><h1><span class="section-number">5.6. </span>Leitura/Escrita de Dados Vetoriais<a class="headerlink" href="#leitura-escrita-de-dados-vetoriais" title="Link permanente para este cabeçalho"></a></h1>
<a class="reference internal image-reference" href="../_images/feature-collection-uf.png"><img alt="Coleção de Feições" class="align-right" src="../_images/feature-collection-uf.png" style="width: 150px;" /></a>
<p>Nesta seção iremos discutir como realizar a leitura e escrita de dados geoespaciais representados na forma de uma <strong>coleção de feições</strong> (<em>feature collection</em>). Para isso, começaremos construindo um pequeno programa que irá abrir um arquivo de dados vetorial no formato <strong>ESRI Shapefile</strong> contendo os limites das Unidades da Federação do Brasil, referentes ao ano de 2018 (<a class="reference internal" href="#fig-vetorial-geo-io-uf-2018"><span class="std std-numref">Figura 5.6</span></a>). Portanto, faça o download do arquivo <a class="reference download external" download="" href="https://1drv.ms/u/s!AtoTP-MfEUEDgq58cYmvg1H3okPCwQ?e=lQtSXZ"><code class="xref download docutils literal notranslate"><span class="pre">uf-2018.zip</span></code></a>, que contém esses dados.</p>
<figure class="align-center align-default" id="fig-vetorial-geo-io-uf-2018">
<a class="reference internal image-reference" href="../_images/uf-2018.png"><img alt="Unidades Federativas do Brasil - 2018" src="../_images/uf-2018.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Figura 5.6 - </span><span class="caption-text">Unidades Federativas do Brasil - 2018. <br/> <strong>Fonte Original:</strong> <a class="reference external" href="https://geoftp.ibge.gov.br/organizacao_do_territorio/malhas_territoriais/malhas_municipais/municipio_2018/Brasil/BR/br_unidades_da_federacao.zip">IBGE</a>.</span><a class="headerlink" href="#fig-vetorial-geo-io-uf-2018" title="Link Permanente para essa imagem"></a></p>
</figcaption>
</figure>
<p>O conjunto de dados no formato ESRI Shapefile é formado pelos seguintes componentes:</p>
<ul class="open">
<li><p><code class="docutils literal notranslate"><span class="pre">uf_2018.dbf</span></code>: o arquivo com extensão <code class="docutils literal notranslate"><span class="pre">.dbf</span></code> contém os atributos alfanuméricos de cada feição geográfica.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uf_2018.shp</span></code>: o arquivo com extensão <code class="docutils literal notranslate"><span class="pre">.shp</span></code> contém os limites das Unidades Federativas, representados por geometrias do tipo <code class="docutils literal notranslate"><span class="pre">MultiPolygon</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uf_2018.shx</span></code>: o arquivo com extensão <code class="docutils literal notranslate"><span class="pre">.shx</span></code> contém um índice posicional para rápido acesso às geometrias do conjunto de dados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uf_2018.cpg</span></code>: o arquivo com extensão <code class="docutils literal notranslate"><span class="pre">.cpg</span></code> contém a codificação de caracteres dos dados contidos no arquivo <code class="docutils literal notranslate"><span class="pre">.dbf</span></code>. Neste caso, a codificação utilizada é a <code class="docutils literal notranslate"><span class="pre">UTF-8</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uf_2018.prj</span></code>: o arquivo com extensão <code class="docutils literal notranslate"><span class="pre">.prj</span></code> contém a descrição do sistema de referência espacial das coordenadas das geometrias. Neste caso, as coordenadas encontram-se na projeção geográfica LAT/LONG e no sistema geodésico de referência SIRGAS 2000.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Para maiores detalhes do formato ESRI Shapefile, consulte <span id="id1">[<a class="reference internal" href="../referencias.html#id113" title="Wikipedia. Shapefile. 2021. Online; acessado 07 de Março de 2021. URL: https://en.wikipedia.org/wiki/Shapefile.">85</a>]</span>.</p>
</div>
<section id="a-biblioteca-fiona">
<h2><span class="section-number">5.6.1. </span>A Biblioteca Fiona<a class="headerlink" href="#a-biblioteca-fiona" title="Link permanente para este cabeçalho"></a></h2>
<p>A biblioteca <a class="reference external" href="https://fiona.readthedocs.io/en/latest/">Fiona</a> oferece funcionalidades para leitura e escrita de dados geoespaciais codificados nos mais diversos formatos. Ela oferece uma API nos mesmos moldes dos protocolos de Entrada e Saída (E/S) da API de arquivos da linguagem Python (Python IO).</p>
<section id="instalacao">
<h3><span class="section-number">5.6.1.1. </span>Instalação<a class="headerlink" href="#instalacao" title="Link permanente para este cabeçalho"></a></h3>
<p>Para realizar a instalação da Fiona com o gerenciador de pacotes da Anaconda, ative o ambiente virtual no qual deseja instalar a biblioteca e, em seguida, instale o pacote com o comando <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span></code>, como mostrado abaixo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="n">fiona</span>
</pre></div>
</div>
<p>Para verificar se sua instalação foi realizada com sucesso, importe essa biblioteca através do seguinte comando:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">fiona</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Para verificar a versão instalada da sua biblioteca, utilize o seguinte comando:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">fiona</span><span class="o">.</span><span class="n">__version__</span>
<span class="gh">Out[5]: </span><span class="go">&#39;1.8.18&#39;</span>
</pre></div>
</div>
</div>
</section>
<section id="leitura-de-dados">
<h3><span class="section-number">5.6.1.2. </span>Leitura de Dados<a class="headerlink" href="#leitura-de-dados" title="Link permanente para este cabeçalho"></a></h3>
<p>O diagrama da <a class="reference internal" href="#fig-vetorial-geo-io-fluxo-io"><span class="std std-numref">Figura 5.7</span></a> apresenta um fluxograma geral das operações necessárias em um programa para realização da leitura de dados a partir de um arquivo qualquer. Em geral, o primeiro passo para leitura de dados consiste na utilização de um comando da linguagem que indique a abertura do arquivo, em modo leitura. Desta maneira, um identificador (ou variável) no programa é associado à estrutura que irá de fato manipular o arquivo no sistema operacional. Depois de aberto o arquivo, pode-se utilizar um ou mais comandos para recuperar os dados armazenados nesse arquivo. No caso de arquivos com uma estrutura bem definida, como é o caso do formato ESRI Shapefile, há a possibilidade de leitura dos metadados que descrevem a própria estrutura dos dados no arquivos, isto é, seu esquema. Por exemplo, os nomes dos atributos das feições das Unidades Federativas e os tipos de dados associados aos valores desses atributos podem ser recuperados. Por último, quando o arquivo não é mais necessário no programa, utiliza-se um comando para indicar o encerramento de seu uso (fechamento) e, consequentemente, a liberação de eventuais recursos associados a ele (como <em>buffers</em> de memória).</p>
<figure class="align-center align-default" id="fig-vetorial-geo-io-fluxo-io">
<a class="reference internal image-reference" href="../_images/fluxo-io.png"><img alt="Fluxograma da leitura de dados a partir de um arquivo" src="../_images/fluxo-io.png" style="width: 30%;" /></a>
<figcaption>
<p><span class="caption-number">Figura 5.7 - </span><span class="caption-text">Fluxograma da leitura de dados a partir de um arquivo.</span><a class="headerlink" href="#fig-vetorial-geo-io-fluxo-io" title="Link Permanente para essa imagem"></a></p>
</figcaption>
</figure>
<p>No caso da biblioteca Fiona, a abertura de um arquivo é realizada através da operação <code class="docutils literal notranslate"><span class="pre">fiona.open</span></code>. Esta operação recebe como argumento o nome do arquivo a ser manipulado. O nome do arquivo pode incluir o seu caminho completo ou relativo. O <a class="reference internal" href="#code-vetorial-geo-io-fiona-file-open"><span class="std std-numref">Trecho de Código 5.6</span></a> mostra como realizar a abertura do arquivo <code class="docutils literal notranslate"><span class="pre">uf_2018.shp</span></code>, localizado no diretório <code class="docutils literal notranslate"><span class="pre">data/uf</span></code>, e, em seguida, escreve na saída padrão o número de feições (ou registros) contidos nessa coleção (27 feições).</p>
<div class="literal-block-wrapper docutils container" id="code-vetorial-geo-io-fiona-file-open">
<div class="code-block-caption"><span class="caption-number">Trecho de Código 5.6 - </span><span class="caption-text">Abrindo o arquivo <code class="docutils literal notranslate"><span class="pre">uf_2018.shp</span></code> para leitura.</span><a class="headerlink" href="#code-vetorial-geo-io-fiona-file-open" title="Link Permanente para esse código"></a></div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos">1</span><span class="gp">In [1]: </span><span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;data/uf/uf_2018.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ufs</span><span class="p">:</span>
</span><span class="linenos">2</span><span class="gp">   ...: </span>    <span class="n">num_feicoes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ufs</span><span class="p">)</span>
<span class="linenos">3</span><span class="gp">   ...: </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Número de feições: </span><span class="si">{</span><span class="n">num_feicoes</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="linenos">4</span><span class="gp">   ...:</span>
<span class="linenos">5</span><span class="go">Número de feições: 27.</span>
</pre></div>
</div>
</div>
<p>O <a class="reference internal" href="#code-vetorial-geo-io-fiona-file-open"><span class="std std-numref">Trecho de Código 5.6</span></a> introduz também uma nova construção em Python, o uso do comando <code class="docutils literal notranslate"><span class="pre">with</span></code>. O comando <code class="docutils literal notranslate"><span class="pre">with</span></code> define um bloco de comandos que deva <strong>inicializar algum recurso</strong> no início da sua execução e, ao final da sua execução tenha que <strong>finalizar (ou liberar) esse recurso</strong>. Nesse caso, o recurso é o arquivo <code class="docutils literal notranslate"><span class="pre">uf_2018.shp</span></code> que ficará associado ao identificador <code class="docutils literal notranslate"><span class="pre">ufs</span></code>. Ao término do último comando do bloco <code class="docutils literal notranslate"><span class="pre">with</span></code>, neste caso o comando <code class="docutils literal notranslate"><span class="pre">print</span></code> na linha 03, o arquivo será automaticamente fechado, sem que seja necessário o uso explícito do comando <code class="docutils literal notranslate"><span class="pre">ufs.close()</span></code>.</p>
<p>Para acessar cada uma das feições armazenadas no arquivo, pode ser utilizado um laço do tipo <code class="docutils literal notranslate"><span class="pre">for</span></code>, como mostrado no <a class="reference internal" href="#code-vetorial-geo-io-fiona-features-read"><span class="std std-numref">Trecho de Código 5.7</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="code-vetorial-geo-io-fiona-features-read">
<div class="code-block-caption"><span class="caption-number">Trecho de Código 5.7 - </span><span class="caption-text">Acesso às feições armazendas no arquivo <code class="docutils literal notranslate"><span class="pre">uf_2018.shp</span></code>.</span><a class="headerlink" href="#code-vetorial-geo-io-fiona-features-read" title="Link Permanente para esse código"></a></div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="gp">In [1]: </span><span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;data/uf/uf_2018.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ufs</span><span class="p">:</span>
<span class="hll"><span class="linenos">2</span><span class="gp">   ...: </span>    <span class="k">for</span> <span class="n">uf</span> <span class="ow">in</span> <span class="n">ufs</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">3</span><span class="gp">   ...: </span>        <span class="nb">print</span><span class="p">(</span><span class="n">uf</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">])</span>
</span><span class="linenos">4</span><span class="gp">   ...:</span>
<span class="linenos">5</span><span class="go">OrderedDict([(&#39;ID&#39;, 1), (&#39;NOME&#39;, &#39;SERGIPE&#39;), (&#39;SIGLA&#39;, &#39;SE&#39;), (&#39;GEOCODIGO&#39;, &#39;28&#39;), (&#39;REGIAO&#39;, &#39;NORDESTE&#39;), (&#39;REGIAO_SIG&#39;, &#39;NE&#39;)])</span>
<span class="linenos">6</span><span class="go">OrderedDict([(&#39;ID&#39;, 2), (&#39;NOME&#39;, &#39;MARANHÃO&#39;), (&#39;SIGLA&#39;, &#39;MA&#39;), (&#39;GEOCODIGO&#39;, &#39;21&#39;), (&#39;REGIAO&#39;, &#39;NORDESTE&#39;), (&#39;REGIAO_SIG&#39;, &#39;NE&#39;)])</span>
<span class="linenos">7</span><span class="go">...</span>
<span class="linenos">8</span><span class="go">OrderedDict([(&#39;ID&#39;, 27), (&#39;NOME&#39;, &#39;TOCANTINS&#39;), (&#39;SIGLA&#39;, &#39;TO&#39;), (&#39;GEOCODIGO&#39;, &#39;17&#39;), (&#39;REGIAO&#39;, &#39;NORTE&#39;), (&#39;REGIAO_SIG&#39;, &#39;N&#39;)])</span>
</pre></div>
</div>
</div>
<p>A linha 03 do <a class="reference internal" href="#code-vetorial-geo-io-fiona-features-read"><span class="std std-numref">Trecho de Código 5.7</span></a> escreve os nomes e valores dos atributos (ou propriedades) alfanuméricos de cada feição. Cada feição possui dois atributos especiais: <code class="docutils literal notranslate"><span class="pre">properties</span></code> e <code class="docutils literal notranslate"><span class="pre">geometry</span></code>. Utilizando a notação do <code class="docutils literal notranslate"><span class="pre">operador[]</span></code>, podemos acessar tanto as propriedades alfanuméricas quanto a geométrica.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>No <a class="reference internal" href="#code-vetorial-geo-io-fiona-file-open"><span class="std std-numref">Trecho de Código 5.6</span></a>, para acessar apenas a primeira feição (ou registro) do arquivo, é possível utilizar a seguinte construção dentro do bloco de comandos <code class="docutils literal notranslate"><span class="pre">with</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uf</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">ufs</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">uf</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">uf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Vamos escrever um programa que compute o centróide para cada uma das geometrias das Unidades Federativas e, em seguida, escreva na saída padrão a localização do centróide e o nome da unidade. Como será necessária a realização de uma operação espacial para geração do centróide, devemos carregar a biblioteca Shapely, como indicado no <a class="reference internal" href="#code-vetorial-geo-io-fiona-compute-centroid"><span class="std std-numref">Trecho de Código 5.8</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="code-vetorial-geo-io-fiona-compute-centroid">
<div class="code-block-caption"><span class="caption-number">Trecho de Código 5.8 - </span><span class="caption-text">Computando o centróide para os polígonos das Unidades Federativas.</span><a class="headerlink" href="#code-vetorial-geo-io-fiona-compute-centroid" title="Link Permanente para esse código"></a></div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">shape</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="gp">In [2]: </span><span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;data/uf/uf_2018.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ufs</span><span class="p">:</span>
<span class="linenos"> 4</span><span class="gp">   ...: </span>    <span class="k">for</span> <span class="n">uf</span> <span class="ow">in</span> <span class="n">ufs</span><span class="p">:</span>
<span class="hll"><span class="linenos"> 5</span><span class="gp">   ...: </span>        <span class="n">geom</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">uf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
</span><span class="hll"><span class="linenos"> 6</span><span class="gp">   ...: </span>        <span class="n">centroide</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">centroid</span>
</span><span class="linenos"> 7</span><span class="gp">   ...: </span>        <span class="n">nome</span> <span class="o">=</span> <span class="n">uf</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;NOME&quot;</span><span class="p">]</span>
<span class="linenos"> 8</span><span class="gp">   ...: </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nome: </span><span class="si">{</span><span class="n">nome</span><span class="si">}</span><span class="s2">; Localização: </span><span class="si">{</span><span class="n">centroide</span><span class="o">.</span><span class="n">wkt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="gp">   ...:</span>
<span class="linenos">10</span><span class="go">Nome: SERGIPE; Localização: POINT (-37.44374619643403 -10.58460970352795)</span>
<span class="linenos">11</span><span class="go">Nome: MARANHÃO; Localização: POINT (-45.28788579867823 -5.072310251937679)</span>
<span class="linenos">12</span><span class="go">...</span>
<span class="linenos">13</span><span class="go">Nome: TOCANTINS; Localização: POINT (-48.32922962739212 -10.15031487315235)</span>
</pre></div>
</div>
</div>
<p>Para finalizar, vamos discutir o código apresentado no <a class="reference internal" href="#code-vetorial-geo-io-fiona-read"><span class="std std-numref">Trecho de Código 5.9</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="code-vetorial-geo-io-fiona-read">
<div class="code-block-caption"><span class="caption-number">Trecho de Código 5.9 - </span><span class="caption-text">Leitura do esquema e dados de um arquivo ESRI Shapefile.</span><a class="headerlink" href="#code-vetorial-geo-io-fiona-read" title="Link Permanente para esse código"></a></div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">fiona</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="gp">In [2]: </span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">shape</span>
<span class="linenos"> 4</span><span class="gp">In [3]: </span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">mapping</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="gp">In [4]: </span><span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;data/uf/uf_2018.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ufs</span><span class="p">:</span>
<span class="linenos"> 7</span><span class="gp">   ...:</span>
<span class="linenos"> 8</span><span class="gp">   ...: </span>    <span class="c1"># Número de feições</span>
<span class="linenos"> 9</span><span class="gp">   ...: </span>    <span class="n">num_feicoes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ufs</span><span class="p">)</span>
<span class="linenos">10</span><span class="gp">   ...:</span>
<span class="linenos">11</span><span class="gp">   ...: </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Número de feições: </span><span class="si">{</span><span class="n">num_feicoes</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">12</span><span class="gp">   ...:</span>
<span class="linenos">13</span><span class="gp">   ...: </span>    <span class="c1"># Sistema de Referência Espacial</span>
<span class="linenos">14</span><span class="gp">   ...: </span>    <span class="n">crs</span> <span class="o">=</span> <span class="n">ufs</span><span class="o">.</span><span class="n">crs</span>
<span class="linenos">15</span><span class="gp">   ...:</span>
<span class="linenos">16</span><span class="gp">   ...: </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CRS: </span><span class="si">{</span><span class="n">crs</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">17</span><span class="gp">   ...:</span>
<span class="linenos">18</span><span class="gp">   ...: </span>    <span class="c1"># Extensão da coleção de feições</span>
<span class="linenos">19</span><span class="gp">   ...: </span>    <span class="n">mbr</span> <span class="o">=</span> <span class="n">ufs</span><span class="o">.</span><span class="n">bounds</span>
<span class="linenos">20</span><span class="gp">   ...:</span>
<span class="linenos">21</span><span class="gp">   ...: </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;xmin: </span><span class="si">{</span><span class="n">mbr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, xmax: </span><span class="si">{</span><span class="n">mbr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">22</span><span class="gp">   ...: </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ymin: </span><span class="si">{</span><span class="n">mbr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, ymax: </span><span class="si">{</span><span class="n">mbr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">23</span><span class="gp">   ...:</span>
<span class="linenos">24</span><span class="gp">   ...: </span>    <span class="c1"># Esquema das feições</span>
<span class="linenos">25</span><span class="gp">   ...: </span>    <span class="n">schema</span> <span class="o">=</span> <span class="n">ufs</span><span class="o">.</span><span class="n">schema</span>
<span class="linenos">26</span><span class="gp">   ...:</span>
<span class="linenos">27</span><span class="gp">   ...: </span>    <span class="c1"># Propriedades alfanuméricas</span>
<span class="linenos">28</span><span class="gp">   ...: </span>    <span class="n">propriedades</span> <span class="o">=</span> <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span>
<span class="linenos">29</span><span class="gp">   ...:</span>
<span class="linenos">30</span><span class="gp">   ...: </span>    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">propriedades</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">31</span><span class="gp">   ...: </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Atributo: </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">, Tipo: </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">32</span><span class="gp">   ...:</span>
<span class="linenos">33</span><span class="gp">   ...: </span>    <span class="c1"># Propriedade geométrica</span>
<span class="linenos">34</span><span class="gp">   ...: </span>    <span class="n">tipo_geometrico</span> <span class="o">=</span> <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
<span class="linenos">35</span><span class="gp">   ...:</span>
<span class="linenos">36</span><span class="gp">   ...: </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tipo do atributo geométrico: </span><span class="si">{</span><span class="n">tipo_geometrico</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">37</span><span class="gp">   ...:</span>
<span class="linenos">38</span><span class="gp">   ...: </span>    <span class="c1"># Acessando cada uma das Unidades Federativas (feições)</span>
<span class="linenos">39</span><span class="gp">   ...: </span>    <span class="k">for</span> <span class="n">uf</span> <span class="ow">in</span> <span class="n">ufs</span><span class="p">:</span>
<span class="linenos">40</span><span class="gp">   ...: </span>        <span class="c1"># obtendo a geometria associada a feição</span>
<span class="linenos">41</span><span class="gp">   ...: </span>        <span class="n">geom</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">uf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
<span class="linenos">42</span><span class="gp">   ...:</span>
<span class="linenos">43</span><span class="gp">   ...: </span>        <span class="c1"># computando o centróide da geometria recuperada</span>
<span class="linenos">44</span><span class="gp">   ...: </span>        <span class="n">centroide</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">centroid</span>
<span class="linenos">45</span><span class="gp">   ...:</span>
<span class="linenos">46</span><span class="gp">   ...: </span>        <span class="c1"># obtendo o atributo NOME associado à feição</span>
<span class="linenos">47</span><span class="gp">   ...: </span>        <span class="n">nome</span> <span class="o">=</span> <span class="n">uf</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;NOME&quot;</span><span class="p">]</span>
<span class="linenos">48</span><span class="gp">   ...:</span>
<span class="linenos">49</span><span class="gp">   ...: </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nome: </span><span class="si">{</span><span class="n">nome</span><span class="si">}</span><span class="s2">, Localização: </span><span class="si">{</span><span class="n">centroide</span><span class="o">.</span><span class="n">wkt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">50</span><span class="gp">   ...:</span>
<span class="linenos">51</span><span class="go">Número de feições: 27</span>
<span class="linenos">52</span>
<span class="linenos">53</span><span class="go">CRS: {&#39;init&#39;: &#39;epsg:4674&#39;}</span>
<span class="linenos">54</span>
<span class="linenos">55</span><span class="go">xmin: -73.99044996899994, xmax: -28.847639913999956</span>
<span class="linenos">56</span><span class="go">ymin: -33.75117799399993, ymax: 5.271841077000033</span>
<span class="linenos">57</span>
<span class="linenos">58</span><span class="go">Atributo: ID, Tipo: int:11</span>
<span class="linenos">59</span><span class="go">Atributo: NOME, Tipo: str:50</span>
<span class="linenos">60</span><span class="go">...</span>
<span class="linenos">61</span><span class="go">Atributo: REGIAO_SIG, Tipo: str:2</span>
<span class="linenos">62</span>
<span class="linenos">63</span><span class="go">Tipo do atributo geométrico: Polygon</span>
<span class="linenos">64</span>
<span class="linenos">65</span><span class="go">Nome: SERGIPE, Localização: POINT (-37.44374619643403 -10.58460970352795)</span>
<span class="linenos">66</span><span class="go">Nome: MARANHÃO, Localização: POINT (-45.28788579867823 -5.072310251937679)</span>
<span class="linenos">67</span><span class="go">...</span>
<span class="linenos">68</span><span class="go">Nome: TOCANTINS, Localização: POINT (-48.32922962739212 -10.15031487315235)</span>
</pre></div>
</div>
</div>
</section>
<section id="escrita-de-dados">
<h3><span class="section-number">5.6.1.3. </span>Escrita de Dados<a class="headerlink" href="#escrita-de-dados" title="Link permanente para este cabeçalho"></a></h3>
<p>O objetivo dessa seção é criar um pequeno programa que leia as feições das Unidades Federativas e, para cada feição desse arquivo calcule o seu centróide, gravando em um arquivo de saída denominado <code class="docutils literal notranslate"><span class="pre">uf_centroides.shp</span></code>, no mesmo diretório do dado de entrada. Para criar este novo arquivo com a biblioteca Fiona, será preciso definir:</p>
<ul class="open">
<li><p>A estrutura dos dados, isto é, o esquema da coleção de feições, que inclui o nome das propriedades (ou atributos), tipos de dados das propriedades e o tipo geométrico.</p></li>
<li><p>O sistema de referência espacial dos dados (<code class="docutils literal notranslate"><span class="pre">CRS</span></code>).</p></li>
<li><p>O tipo do <strong>driver</strong> que será usado para escrita dos dados.</p></li>
</ul>
<p>A coleção de saída, <code class="docutils literal notranslate"><span class="pre">uf_centroides.shp</span></code>, terá duas propriedades alfanuméricas: (1) o identificador, que será um valor do tipo inteiro e (2) o nome da Unidade Federativa, uma string. O tipo geométrico será <code class="docutils literal notranslate"><span class="pre">Point</span></code>. O <code class="docutils literal notranslate"><span class="pre">CRS</span></code> será o mesmo das geometrias do dado de entrada, <code class="docutils literal notranslate"><span class="pre">EPSG:4674</span></code>. Como o objetivo é criar um novo arquivo ESRI Shapefile, usaremos o <em>driver</em>  que possui este nome.</p>
<p>Vamos começar criando um dicionário com o esquema da coleção:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">schema_centroides</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">   ...: </span>        <span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">),</span>
<span class="gp">   ...: </span>        <span class="p">(</span><span class="s2">&quot;NOME&quot;</span><span class="p">,</span> <span class="s2">&quot;str:50&quot;</span><span class="p">)</span>
<span class="gp">   ...: </span>    <span class="p">]</span>
<span class="gp">   ...: </span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Aviso</p>
<p>A chave <code class="docutils literal notranslate"><span class="pre">properties</span></code> pode ser uma lista ou um <code class="docutils literal notranslate"><span class="pre">OrderedDict</span></code>. O importante é utilizar uma estrutura que garanta a ordem dos elementos. Lembre-se que o <code class="docutils literal notranslate"><span class="pre">dict</span></code> pode não garantir isso dependendo das versões da linguagem Python.</p>
</div>
<p>Em seguida, vamos utilizar o comando <code class="docutils literal notranslate"><span class="pre">fiona.open</span></code> duas vezes. A primeira, para criar o novo arquivo, chamado <code class="docutils literal notranslate"><span class="pre">uf_centroides.shp</span></code> no diretório <code class="docutils literal notranslate"><span class="pre">data/uf</span></code>, com o esquema definido acima (<code class="docutils literal notranslate"><span class="pre">schema_centroides</span></code>), o <em>driver</em> <code class="docutils literal notranslate"><span class="pre">ESRI</span> <span class="pre">Shapefile</span></code>, e o <em>CRS</em> <code class="docutils literal notranslate"><span class="pre">EPSG:4674</span></code>. E o segundo uso do comando <code class="docutils literal notranslate"><span class="pre">fiona.open</span></code> irá abrir o arquivo <code class="docutils literal notranslate"><span class="pre">uf_2018.shp</span></code> para leitura.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">fiona</span>
<span class="gp">In [2]: </span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">shape</span>
<span class="gp">In [3]: </span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">mapping</span>

<span class="gp">In [4]: </span><span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;data/uf/uf_centroides.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
<span class="gp">   ...: </span>                <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;ESRI Shapefile&quot;</span><span class="p">,</span>
<span class="gp">   ...: </span>                <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4674&quot;</span><span class="p">,</span>
<span class="gp">   ...: </span>                <span class="n">schema</span><span class="o">=</span><span class="n">schema_centroides</span><span class="p">)</span> <span class="k">as</span> <span class="n">centroides</span><span class="p">,</span> \
<span class="gp">   ...: </span>     <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;data/uf/uf_2018.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ufs</span><span class="p">:</span>
<span class="gp">   ...:</span>
<span class="gp">   ...: </span>     <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">uf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ufs</span><span class="p">):</span>
<span class="gp">   ...: </span>         <span class="n">geom</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">uf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
<span class="gp">   ...: </span>         <span class="n">centroide</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">centroid</span>
<span class="gp">   ...:</span>
<span class="gp">   ...: </span>         <span class="n">nome</span> <span class="o">=</span> <span class="n">uf</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;NOME&quot;</span><span class="p">]</span>
<span class="gp">   ...:</span>
<span class="gp">   ...: </span>         <span class="n">feature</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">   ...: </span>             <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
<span class="gp">   ...: </span>             <span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
<span class="gp">   ...: </span>             <span class="n">properties</span><span class="o">=</span><span class="n">OrderedDict</span> <span class="p">(</span>
<span class="gp">   ...: </span>                 <span class="n">ID</span><span class="o">=</span><span class="n">uf</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;ID&quot;</span><span class="p">],</span>
<span class="gp">   ...: </span>                 <span class="n">NOME</span><span class="o">=</span><span class="n">uf</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;NOME&quot;</span><span class="p">]</span>
<span class="gp">   ...: </span>             <span class="p">),</span>
<span class="gp">   ...: </span>             <span class="n">geometry</span><span class="o">=</span><span class="n">mapping</span><span class="p">(</span><span class="n">centroide</span><span class="p">)</span>
<span class="gp">   ...: </span>         <span class="p">)</span>
<span class="gp">   ...:</span>
<span class="gp">   ...: </span>         <span class="n">centroides</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
<span class="gp">   ...:</span>
</pre></div>
</div>
</section>
<section id="acessando-arquivos-via-http-https">
<h3><span class="section-number">5.6.1.4. </span>Acessando Arquivos via HTTP/HTTPS<a class="headerlink" href="#acessando-arquivos-via-http-https" title="Link permanente para este cabeçalho"></a></h3>
<p>A Fiona oferece a possibilidade de acessar arquivos ESRI Shapefile através dos protocolos HTTP ou HTTPS. O <a class="reference internal" href="#code-vetorial-geo-io-fiona-url"><span class="std std-numref">Trecho de Código 5.10</span></a> mostra como ler as amostras contidas no arquivo <code class="docutils literal notranslate"><span class="pre">bdc_paper_samples.shp</span></code> disponível na seguinte URL: <a class="reference external" href="https://brazildatacube.dpi.inpe.br/geo-knowledge-hub/bdc-article/training-samples/shp/bdc_paper_samples.shp">https://brazildatacube.dpi.inpe.br/geo-knowledge-hub/bdc-article/training-samples/shp/bdc_paper_samples.shp</a>.</p>
<div class="literal-block-wrapper docutils container" id="code-vetorial-geo-io-fiona-url">
<div class="code-block-caption"><span class="caption-number">Trecho de Código 5.10 - </span><span class="caption-text">Leitura de um arquivo ESRI Shapefile via HTTPS.</span><a class="headerlink" href="#code-vetorial-geo-io-fiona-url" title="Link Permanente para esse código"></a></div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="gp">In [1]: </span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://brazildatacube.dpi.inpe.br/geo-knowledge-hub/bdc-article/training-samples/shp/bdc_paper_samples.shp&quot;</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="gp">In [2]: </span><span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">samples</span><span class="p">:</span>
<span class="linenos">4</span><span class="gp">   ...: </span>    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
<span class="linenos">5</span><span class="gp">   ...: </span>        <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="linenos">6</span><span class="gp">   ...:</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="a-biblioteca-gdal-ogr">
<h2><span class="section-number">5.6.2. </span>A biblioteca GDAL/OGR<a class="headerlink" href="#a-biblioteca-gdal-ogr" title="Link permanente para este cabeçalho"></a></h2>
<p>A parte da biblioteca <code class="docutils literal notranslate"><span class="pre">GDAL</span></code> voltada para manipulação de dados vetoriais é conhecida por <code class="docutils literal notranslate"><span class="pre">OGR</span></code>. A <a class="reference internal" href="#fig-vetorial-geo-io-ogr"><span class="std std-numref">Figura 5.8</span></a> apresenta as principais classes que compõem esta API.</p>
<figure class="align-center align-default" id="fig-vetorial-geo-io-ogr">
<a class="reference internal image-reference" href="../_images/modelo-ogr.png"><img alt="Modelo de objetos da OGR em Python" src="../_images/modelo-ogr.png" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-number">Figura 5.8 - </span><span class="caption-text">Modelo de objetos da OGR em Python.</span><a class="headerlink" href="#fig-vetorial-geo-io-ogr" title="Link Permanente para essa imagem"></a></p>
</figcaption>
</figure>
<p>A classe <code class="docutils literal notranslate"><span class="pre">DataSource</span></code> representa uma coleção de camadas de informação ou <em>layers</em>. Um objeto <code class="docutils literal notranslate"><span class="pre">DataSource</span></code> pode ser usado para acessar um único arquivo, um conjunto de arquivos, um conjunto de tabelas de um banco de dados, ou coleções de feições em um serviço Web do tipo OGC Web Feature Service (WFS).</p>
<p>A classe <code class="docutils literal notranslate"><span class="pre">Layer</span></code> representa uma camada de informação contida em um <code class="docutils literal notranslate"><span class="pre">DataSource</span></code>. Essa classe contém operações que possibilitam a leitura e escrita de feições (<em>features</em>), isto é, um objeto geográfico. Neste documento também usaremos o termo <em>coleção de feições</em> (ou <em>feature collection</em>) quando nos referirmos a uma camada de informação.</p>
<p>Todas as feições de uma mesma camada possuem a mesma estrutura, isto é, o mesmo conjunto de atributos. Denominamos esta estrutura da camada de informação de <strong>esquema</strong>. A classe <code class="docutils literal notranslate"><span class="pre">FeatureDefn</span></code> é usada para descrever o esquema de uma camada de informação, isto é, ela fornece uma lista com o nome dos atributos e seus respectivos tipos de dados. As feições pertencentes a uma mesma camada de informação irão compartilhar esta estrutura.</p>
<p>A classe <code class="docutils literal notranslate"><span class="pre">Feature</span></code> representa os dados de uma feição, que podem ser valores alfanuméricos e geométricos.</p>
<p>Para entender melhor esta estrutura (<a class="reference internal" href="#fig-vetorial-geo-io-ogr"><span class="std std-numref">Figura 5.8</span></a>), vamos considerar o arquivo <code class="docutils literal notranslate"><span class="pre">uf_2018.shp</span></code> (<a class="reference internal" href="#fig-vetorial-geo-io-uf-2018"><span class="std std-numref">Figura 5.6</span></a>) introduzido no início dessa seção (<a class="reference internal" href="#sec-vetorial-geo-io"><span class="std std-numref">Seção 5.6</span></a>). Um objeto do tipo <code class="docutils literal notranslate"><span class="pre">DataSource</span></code> (fonte de dados) irá representar esse conjunto de arquivos. A partir dele, teremos acesso ao conjunto de feições (municípios) através de um objeto do tipo <code class="docutils literal notranslate"><span class="pre">Layer</span></code> (camada de informação). Esse objeto por sua vez irá possibilitar acessar os dados de cada município, através de objetos do tipo <code class="docutils literal notranslate"><span class="pre">Feature</span></code> (feição geográfica). A partir de um objeto do tipo <code class="docutils literal notranslate"><span class="pre">Feature</span></code> podemos obter tanto os atributos alfanuméricos, como o código e nome da Unidade Federativa, e a geometria usada para representar seus limites (coleções de polígonos).</p>
<p>Ainda completam o diagrama da <a class="reference internal" href="#fig-vetorial-geo-io-ogr"><span class="std std-numref">Figura 5.8</span></a>, a classe <code class="docutils literal notranslate"><span class="pre">FieldDefn</span></code>, que representa as informações de um dado atributo do esquema da camada de informação; e, a classe <code class="docutils literal notranslate"><span class="pre">Geometry</span></code>, que representa os tipos geométricos suportados pela <code class="docutils literal notranslate"><span class="pre">OGR</span></code>, como pontos, linhas e polígonos, e as coleções homogêneas desses elementos geométricos.</p>
<section id="instalando-a-biblioteca-gdal-ogr">
<h3><span class="section-number">5.6.2.1. </span>Instalando a biblioteca GDAL/OGR<a class="headerlink" href="#instalando-a-biblioteca-gdal-ogr" title="Link permanente para este cabeçalho"></a></h3>
<p>Para instalar a <code class="docutils literal notranslate"><span class="pre">GDAL/OGR</span></code>, ative seu ambiente de trabalho da Anaconda e instale o pacote através do <code class="docutils literal notranslate"><span class="pre">conda</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="n">gdal</span><span class="o">=</span><span class="mi">3</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>No meu ambiente, foi instalada a versão <code class="docutils literal notranslate"><span class="pre">3.1.4</span></code>.</p>
</div>
</section>
<section id="carregando-a-biblioteca-gdal-ogr">
<h3><span class="section-number">5.6.2.2. </span>Carregando a Biblioteca GDAL/OGR<a class="headerlink" href="#carregando-a-biblioteca-gdal-ogr" title="Link permanente para este cabeçalho"></a></h3>
<p>Uma boa prática ao trabalhar com bibliotecas que não fazem parte da distribuição padrão do Python consiste na verificação de sua carga logo após as instruções <code class="docutils literal notranslate"><span class="pre">import</span></code>. O trecho de código abaixo mostra como realizar essa verificação logo no início do seu <em>script</em>, para certificar que a biblioteca <code class="docutils literal notranslate"><span class="pre">GDAL</span></code> tenha sido devidamente carregada antes de prosseguir com as próximas instruções do programa. Neste <em>script</em>, utilizamos um bloco <code class="docutils literal notranslate"><span class="pre">try-except</span></code> para verificar se o módulo <code class="docutils literal notranslate"><span class="pre">osgeo</span></code> e as APIs <code class="docutils literal notranslate"><span class="pre">ogr</span></code> e <code class="docutils literal notranslate"><span class="pre">gdal</span></code> foram devidamente carregados (<code class="docutils literal notranslate"><span class="pre">linhas</span> <span class="pre">3-6</span></code>). Na <code class="docutils literal notranslate"><span class="pre">linha</span> <span class="pre">9</span></code> utilizamos a função <code class="docutils literal notranslate"><span class="pre">VersionInfo</span></code> da API <code class="docutils literal notranslate"><span class="pre">GDAL</span></code> para obter uma string com a versão e data de build da <code class="docutils literal notranslate"><span class="pre">GDAL</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">4</span>    <span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span><span class="p">,</span> <span class="n">ogr</span>
<span class="linenos">5</span><span class="k">except</span><span class="p">:</span>
<span class="linenos">6</span>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;ERRO: módulo GDAL/OGR não encontrado!&#39;</span><span class="p">)</span>
<span class="linenos">7</span>
<span class="linenos">8</span><span class="c1"># versão da biblioteca GDAL/OGR</span>
<span class="linenos">9</span><span class="nb">print</span><span class="p">(</span><span class="n">gdal</span><span class="o">.</span><span class="n">VersionInfo</span><span class="p">(</span><span class="s1">&#39;VERSION&#39;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3><span class="section-number">5.6.2.3. </span>Leitura de Dados<a class="headerlink" href="#id2" title="Link permanente para este cabeçalho"></a></h3>
<p>Vamos abrir o arquivo <code class="docutils literal notranslate"><span class="pre">uf_2018.shp</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shp</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s1">&#39;data/uf/uf_2018.shp&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Veja que a operação <code class="docutils literal notranslate"><span class="pre">ogr.Open</span></code> cria um objeto chamado <code class="docutils literal notranslate"><span class="pre">shp</span></code> da classe <code class="docutils literal notranslate"><span class="pre">DataSource</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
</pre></div>
</div>
<p>A partir de um objeto do tipo <code class="docutils literal notranslate"><span class="pre">DataSource</span></code> podemos recuperar a camada de informação contida nessa fonte atravé do método <code class="docutils literal notranslate"><span class="pre">GetLayer</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span> <span class="o">=</span> <span class="n">shp</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">(</span><span class="s1">&#39;uf_2018&#39;</span><span class="p">)</span>

<span class="nb">type</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
</pre></div>
</div>
<p>De um objeto do tipo <code class="docutils literal notranslate"><span class="pre">Layer</span></code> podemos recuperar algumas informações básicas, como mostrado abaixo:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nome_layer</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Layer: </span><span class="si">{</span><span class="n">nome_layer</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">bbox</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">GetExtent</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Extensão.......: </span><span class="si">{</span><span class="n">bbox</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">crs</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">GetSpatialRef</span><span class="p">()</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">SRS............: </span><span class="si">{</span><span class="n">crs</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">tipo_geometrias</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">GetGeomType</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Tipo Geométrico: </span><span class="si">{</span><span class="n">tipo_geometrias</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Polígonos? &#39;</span><span class="p">,</span> <span class="n">tipo_geometrias</span> <span class="o">==</span> <span class="n">ogr</span><span class="o">.</span><span class="n">wkbMultiPolygon</span><span class="p">)</span>

<span class="n">num_features</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">GetFeatureCount</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">#Feições.......: </span><span class="si">{</span><span class="n">num_features</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Podemos também obter o esquema das feições da camada:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layer_def</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Name       - Type    Width  Precision&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer_def</span><span class="o">.</span><span class="n">GetFieldCount</span><span class="p">()):</span>

    <span class="n">field_name</span> <span class="o">=</span>  <span class="n">layer_def</span><span class="o">.</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
    <span class="n">field_type_code</span> <span class="o">=</span> <span class="n">layer_def</span><span class="o">.</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetType</span><span class="p">()</span>
    <span class="n">field_type</span> <span class="o">=</span> <span class="n">layer_def</span><span class="o">.</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetFieldTypeName</span><span class="p">(</span><span class="n">field_type_code</span><span class="p">)</span>
    <span class="n">field_width</span> <span class="o">=</span> <span class="n">layer_def</span><span class="o">.</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetWidth</span><span class="p">()</span>
    <span class="n">field_precision</span> <span class="o">=</span> <span class="n">layer_def</span><span class="o">.</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetPrecision</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">field_name</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> \
          <span class="n">field_type</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
          <span class="nb">str</span><span class="p">(</span><span class="n">field_width</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
          <span class="nb">str</span><span class="p">(</span><span class="n">field_precision</span><span class="p">))</span>
</pre></div>
</div>
<p>Para acessar os elementos da camada podemos utilizar um laço do tipo <code class="docutils literal notranslate"><span class="pre">for</span></code> como o mostrado abaixo:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">:</span>
    <span class="n">nome</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;NOME&quot;</span><span class="p">)</span>

    <span class="n">geom</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetGeometryRef</span><span class="p">()</span>
    <span class="n">centroide</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">Centroid</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nome: </span><span class="si">{</span><span class="n">nome</span><span class="si">}</span><span class="s2">, Localização: </span><span class="si">{</span><span class="n">centroide</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Um bom recurso sobre a API Python da GDAL/OGR pode ser encontrado em <span id="id3">[<a class="reference internal" href="../referencias.html#id16" title="Michael Payne ared Erickson, Cort Daniel. Python gdal/ogr cookbook. May 2021. Online; acessado 13 de Maio de 2021. URL: https://pcjericks.github.io/py-gdalogr-cookbook/#.">1</a>]</span>. A documentação da API Python GDAL/OGR pode ser encontrada em <span id="id4">[<a class="reference internal" href="../referencias.html#id18" title="GDAL. Gdal/ogr python api. 2021. Online; acessado 13 de Maio de 2021. URL: https://gdal.org/python/.">38</a>]</span>.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Rodapé">
        <a href="geojson.html" class="btn btn-neutral float-left" title="5.5. Documentos GeoJSON" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="pandas.html" class="btn btn-neutral float-right" title="5.7. Pandas" accesskey="n" rel="next">Próximo <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, Gilberto Queiroz and Thales Körting.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-165908761-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-165908761-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>